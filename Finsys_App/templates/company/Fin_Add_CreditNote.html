{% extends 'company/Fin_base.html' %}
{% block body %}
{% load static %}
<script src="https://kit.fontawesome.com/a076d05399.js" ></script>
<!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"> -->




<form action="{% url 'Fin_CreditNote_Create' %}" method="post" enctype="multipart/form-data" autocomplete="off">
{% csrf_token %}
    <div class="page-content">
            <!--breadcrumb-->
        <div class="card radius-15">
            <div class="card-body">
                <div class="card-title">
                    <center><h3 class="mb-0" id="invnumb">CREDIT NOTE</h3></center>
                </div>
                <hr/>
            </div>
        </div>
            <!--end breadcrumb-->
            <div class="card radius-15">
                <div class="card-body">
                  <div id="CreditNote">
                      <div class="row">
                          <div class="col-md-4 mt-3">
                              <label class="">Select Customer</label><span class="text-danger ml-3" id="custErr"></span>
                              <input type="hidden" name="customerId" id="customerId" value="">
                              <div class="d-flex">
                                  <div class="w-100">
                                      <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                          <input required type="text" id="customer" value="" name="customer" class="dropdown-toggle form-control customers-display" onkeyup="filterCustomers()" data-toggle="dropdown" aria-expanded="false" placeholder="Select Customer.." autocomplete="off">
                                          <ul class="dropdown-menu w-100 customers-available position-absolute" id="cust_drop"  style="overflow-y: auto; height: fit-content;max-height: 40vh;"> 
                                            <li class="dropdown-item customers-options" onclick="getCustomerDetails('','')">Select Customer</li>
                                            {% for cust in customers %}
                                            <li class="dropdown-item customers-options" onclick="getCustomerDetails(`{{cust.id}}`,this.innerHTML)">{{ cust.title }} {{ cust.first_name }} {{ cust.last_name }}</li>
                                            {% endfor %}
                                        </ul>
                                          
                                      </div>
                                  </div>
                                  <button type="button" data-toggle="modal" data-target="#newCustomer" class="btn btn-outline-secondary ml-1">+</button>
                              </div>
          
                              <label class="mt-3">GST Type</label>
                              <input type="text" class="form-control" id="gstType" name="gst_type" placeholder="GST Treatment" style="background-color: #43596c;" readonly>
                          </div>
          
                          <div class="col-md-4 mt-3">
                              <label class="">Email</label>
                              <input class="form-control" type="email" name="customerEmail" placeholder="Email" style="background-color: #43596c; color: white;" id="customerEmail" readonly>
                              <div class="mt-3" id="gstInDisplay" style="display: block;">
                                  <label class="">GSTIN</label>
                                  <input type="text" class="form-control" id="gstin" name="gstin" placeholder="GSTIN" style="background-color: #43596c;" readonly>
                              </div>
                          </div>
          
                          <div class="col-md-4 mt-3">
                              <label class="">Billing Address</label>
                              <textarea class="form-control" name="bill_address" id="billAddress" rows="4" style="background-color: #43596c; color: white;" readonly></textarea>
                          </div>
                      </div>
          
                      <div class="row">
                          <div class="col-md-4 mt-3">
                              <div class="d-flex">
                                  <label class="">Credit Note No.</label><span class="text-danger ml-3" id="EstNOErr"></span>
                              </div>
                              <input type="text" class="form-control" name="CreditNote_no"  id="CreditNoteNumber" style="background-color: #43596c;" placeholder="{{ESTNo}}" required>
                          </div>
                          <div class="col-md-4 mt-3">
                              <label class="">Reference Number</label>
                              <input type="text" class="form-control" name="reference_number" value="{{ref_no}}" style="background-color: #43596c;" readonly>
                          </div>
                          <div class="col-md-4 mt-3">
                              <input hidden value="{{cmp.State}}" id="cmpstate">
                              <label class="">Place of supply</label>
                              <select type="text" class="form-control" id="placeOfSupply" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                                  <option value="" selected>--Choose--</option>
                                  <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads</option>
                                  <option value="Andhra Predhesh">Andhra Predhesh</option>
                                  <option value="Arunachal Predesh">Arunachal Predesh</option>
                                  <option value="Assam">Assam</option>
                                  <option value="Bihar">Bihar</option>
                                  <option value="Chandigarh">Chandigarh</option>
                                  <option value="Chhattisgarh">Chhattisgarh</option>
                                  <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                  <option value="Damn anad Diu">Damn anad Diu</option>
                                  <option value="Delhi">Delhi</option>
                                  <option value="Goa">Goa</option>
                                  <option value="Gujarat">Gujarat</option>
                                  <option value="Haryana">Haryana</option>
                                  <option value="Himachal Predesh">Himachal Predesh</option>
                                  <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                  <option value="Jharkhand">Jharkhand</option>
                                  <option value="Karnataka">Karnataka</option>
                                  <option value="Kerala">Kerala</option>
                                  <option value="Ladakh">Ladakh</option>
                                  <option value="Lakshadweep">Lakshadweep</option>
                                  <option value="Madhya Predesh">Madhya Predesh</option>
                                  <option value="Maharashtra">Maharashtra</option>
                                  <option value="Manipur">Manipur</option>
                                  <option value="Meghalaya">Meghalaya</option>
                                  <option value="Mizoram">Mizoram</option>
                                  <option value="Nagaland">Nagaland</option>
                                  <option value="Odisha">Odisha</option>
                                  <option value="Puducherry">Puducherry</option>
                                  <option value="Punjab">Punjab</option>
                                  <option value="Rajasthan">Rajasthan</option>
                                  <option value="Sikkim">Sikkim</option>
                                  <option value="Tamil Nadu">Tamil Nadu</option>
                                  <option value="Telangana">Telangana</option>
                                  <option value="Tripura">Tripura</option>
                                  <option value="Uttar Predesh">Uttar Predesh</option>
                                  <option value="Uttarakhand">Uttarakhand</option>
                                  <option value="West Bengal">West Bengal</option>
                                  <option value="Other Territory">Other Territory</option>
                              </select>
                          </div>
                      </div>
          
                      <div class="row">
                          <div class="col-md-4 mt-3">
                              <label class="">Credit Note Date:</label>
                              <input type="date" class="form-control" name="CreditNote_date" id="CreditNoteDate" style="background-color: #43596c; color: white;" value="{% now 'Y-m-d' %}">
                          </div>
                          
                          <!-- <div class="col-md-4 mt-3">
                              <label class="">Terms </label>
                              <div class="d-flex">
                                  <select class="form-control" name="payment_term" style="background-color: #43596c; color: white;" id="paymentTerm" required>
                                      <option value="" selected> Select Payment Term</option>
                                      {% for term in pTerms %}
                                          <option value="{{term.id}}" text="{{term.days}}">{{term.term_name}}</option>
                                      {% endfor %}
                                  </select>
                                  <a class="btn btn-outline-secondary ml-1" role="button" data-target="#newPaymentTerm" data-toggle="modal" id="termsadd">+</a>
                              </div>
                          </div> -->
          
                          <div class="col-md-4 mt-3">
                              <label class="">Payment Type</label>
                              <select class="form-control my-select" id="paymentMethod" name="payment_method" style="background-color: #43596c;">
                                  <option value="" selected>Select Payment Method</option>
                                  <option value="Cash">Cash</option>
                                  <option value="Cheque">Cheque</option>
                                  <option value="UPI">UPI</option>
                                  {% for b in banks %}
                                  <option value="{{ b.bank_name }}" text="{{ b.id }}">{{ b.bank_name }} (XXX{{ b.account_number|slice:"-4:" }})</option>
                                  {% endfor %}
                              </select>
                          </div>
                          <div class="col-md-4 mt-3" style="display:none;"  id="chequediv">
                              <label class="" >Cheque No</label>
                              <input type="text" class="form-control" name="cheque_id" id="cheque_id" placeholder="Enter Cheque No">
                          </div>
                          <div class="col-md-4 mt-3"  style="display:none;" id="upidiv">
                              <label class="" >UPI ID</label>
                              <input type="text" class="form-control" name="upi_id" id="upi_id" placeholder="Enter UPI ID">
                          </div>
                          <div class="col-md-4 mt-3"  style="display:none;" id="bnkdiv">
                              <label class="" >Account#</label>
                              <input type="text" class="form-control" name="bnk_id" id="bnk_id" style="background-color: #43596c;" readonly>
                          </div>
                      </div>
          
                      <div class="row clearfix ">
                          <div class="col-md-12 table-responsive-md mt-3">
                              <table class="table table-bordered table-hover mt-3" id="CreditNoteItemsTable">
                                  <thead>
                                      <tr>
                                          <th class="text-center">#</th>
                                          <th class="text-center">PRODUCT / SERVICE</th>
                                          <th class="text-center">HSN</th>
                                          <th class="text-center">QTY</th>
                                          <th class="text-center">PRICE</th>
                                          <th class="text-center">TAX (%)</th>
                                          <th class="text-center">DISCOUNT</th>
                                          <th class="text-center">TOTAL</th>
                                      </tr>
                                  </thead>
                                  <tbody id="items-table-body">
                                      <tr id='tab_row1'>
                                          <td class="nnum" style="text-align: center;">1</td>
                                          <td style="width: 20%;">
                                              <div class="d-flex">
                                                  <div class="w-100">
                                                      <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                                          <input required type="text" id="item1" value="" name="item_name[]" class="dropdown-toggle form-control item-display" onkeyup="filterFunction($(this).attr('id'))"  data-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                                                          <ul class="dropdown-menu w-100 items-available position-absolute" id="menu1"  style="overflow-y: auto; height: fit-content;max-height: 40vh;"> 
                                                              {% for i in items %}
                                                              <li class="dropdown-item items-options" style="cursor: pointer;" onclick="getItemDetails($(this).parent().prev().attr('id'),`{{i.name}}`)">{{i.name}}</li>
                                                              {% endfor %}
                                                          </ul>
                                                      </div>
                                                  </div>
                                                  <a href="#">
                                                      <button type="button" class="btn btn-outline-secondary ml-1" data-target="#newItem" data-toggle="modal">+</button>
                                                  </a>
                                              </div>
                                          
                                          </td>
                                          <td>
                                              <input type="hidden" name="item_id[]" id="itemId1">
                                              <input type="text" name='hsn[]' id="hsn1" placeholder='HSN Code' class="form-control HSNCODE" style="background-color: #43596c; color: white;" readonly />
                                          </td>
                                          <td >
                                              <input type="number" name='qty[]' id="qty1"  class="form-control qty" step=0 min=1 style="background-color: #43596c; color: white;" value=0 required/>
                                          </td>
                                          <td>
                                              <input type="number" name='price[]' id="price1" class="form-control price" step="0.00" min="0" style="background-color: #43596c; color: white; display: block;" value=0 readonly />
                                          </td>
                                          
                                          <td style="width: 13%;">
                                              <!-- <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex"> -->
                                              <select name='taxGST[]' id="taxGST1" class="form-control tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                                                  <option selected disabled hidden>Select GST</option>
                                                  <option value=28 >28.0% GST</option>
                                                  <option value=18 >18.0% GST</option>
                                                  <option value=12 >12.0% GST</option>
                                                  <option value=5 >05.0% GST</option>
                                                  <option value=3 >03.0% GST</option>
                                                  <option value=0 >0.0% GST</option>
                                              </select>
                                              <select name='taxIGST[]' id="taxIGST1" class="form-control tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                                                  <option selected disabled hidden >Select IGST</option>
                                                  <option value=28 >28.0% IGST</option>
                                                  <option value=18 >18.0% IGST</option>
                                                  <option value=12 >12.0% IGST</option>
                                                  <option value=5 >05.0% IGST</option>
                                                  <option value=3 >03.0% IGST</option>
                                                  <option value=0 >0.0% IGST</option>
                                              </select>
                                              <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax1" style="display: none;"> Invalid Tax %</span> </div>    
                                          </td>
                                          <td >
                                              <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control disc" step=0 min=0 style="background-color: #43596c;  color: white;"  />
                                          </td>
          
                                          <td><input type="number" name='total[]' id="total1" class="form-control total" value=0 readonly style="background-color: #43596c; color: white;" /></td>
                                          <td style="display: none;"><input type="hidden" id="taxamount1" class="form-control itemTaxAmount" /></td>
                                          <td>
                                              <!-- <button type="button" id="1" class="btn font-weight-bold clone_row fa fa-clone px-2 my-1 py-1" title="Clone Row" style="background-color:rgb(88, 107, 143);"></button><br> -->
                                              <button type="button" id="1" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                                          </td>
                                      </tr>
                                  </tbody>
                                  <tr>
                                      <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add" >+</a></td>
                                  </tr>
                              </table>
                          </div>
                      </div>
                      <div class="row clearfix" style="margin-top:20px">
                          <div class="col-md-6">
                              <textarea class="form-control mt-3"  id="" name="note" placeholder="Note" style="height: 190px;"></textarea>
                              <input type="file" name="file"  style="margin-top: 10px; width: 70%;">
                          </div>            
                          <div class="col-md-1"></div>
                          <div class="col-md-5 table-responsive-md mt-3 " id="CreditNoteItemsTableTotal" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                              <div class="p-3">
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label class="text-center">Sub Total</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" step="any" name='subtotal' value=0.00 readonly style="background-color: #37444f;" class="form-control" id="sub_total"></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0" id="taxamountIGST" style="display: flex;">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">IGST</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" name='igst' step="any" id="igstAmount" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountCGST">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">CGST</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" name='cgst' step="any" id="cgstAmount" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountSGST">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">SGST</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" name='sgst' step="any" id="sgstAmount" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Tax Amount</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" step="any" name='taxamount' id="tax_amount" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                                  </div>
                                  
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Shipping Charge</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" step="any" name='ship' id="ship" value=0.00 class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Adjustment</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" step="any" name='adj' id="adj" value=0.00 class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Grand Total</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" name='grandtotal' id="grandtotal" value=0.00 readonly style="background-color: #37444f;" class="form-control"/></div>
                                  </div>
                              </div>
                          </div>
                      </div>
                      <!-- <div class="row">
                          <div class="col-md-7"></div>
                          <div class="col-md-5 table-responsive-md mt-3 " id="CreditNoteItemsTablePaid" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                              <div class="p-3">
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Paid Off</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" step="any" name='advance' id="advance"  value=0.00 class="form-control"/></div>
                                  </div>
                                  <div class="row container-fluid p-2 m-0">
                                      <div class="col-sm-4 mt-2"><label for="a" class="text-center">Balance</label></div>
                                      <div class="col-sm-1 mt-2">:</div>
                                      <div class="col-sm-7 mt-2"><input type="number" name='balance' id="balance" value=0.00 readonly style="background-color: #37444f;" class="form-control" readonly /></div>
                                  </div>
                              </div>
                          </div>
                      </div> -->
          
                  
                      <div class="row">
                          <div class="col-md-7 mt-3">
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required style="background-color: #43596c;">
                                  <label for="agreeTerms">Agree to terms and conditions</label>
                                  <div class="invalid-feedback">You must agree before submitting.</div>
                              </div>
                          </div>
                          <div class="col-md-5 mt-3 d-flex">
                              <input type="submit" class="btn btn-outline-secondary w-50 text-light" name="Draft" value="Draft">
                              <input type="submit" class="btn btn-outline-secondary w-50 ml-1 text-light" name="Save" value="Save">
                              <input type="submit" class="btn btn-outline-secondary w-50 ml-1 text-light" name="Cancel" value="Cancel">
                          </div>
                      </div>
                      <div class="notices mt-3">
                          <div class="text-muted">NOTICE:</div>
                          <div class="text-muted">Fin sYs Terms and Conditions Apply</div>
                      </div>
                      <footer class="text-muted">CreditNote was created on a computer and is valid without the signature and seal.</footer>
                  </div>
                </div>
              </div>
        </div>
    </div>
</form>

<!-- New Customer Modal -->

<div class="modal fade" id="newCustomer">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Customer</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="newCustomerForm">
                        {% csrf_token %}
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="title">Title</label>
                                <select name="title" id="title" class="form-control">
                                    <option value="Mr">Mr</option>
                                    <option value="Mrs">Mrs</option>
                                    <option value="Miss">Miss</option>
                                    <option value="Ms">Ms</option>
                                </select>
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="firstName">First Name*</label>
                                <input type="text" class="form-control" id="firstName" name="first_name" required style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="lastName">Last Name*</label>
                                <input type="text" class="form-control" id="lastName" name="last_name" required style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                        </div>
    
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="companyName">Company</label>
                                <input type="text" class="form-control" id="companyName" name="company_name" style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="location">Location</label>
                                <input type="text" class="form-control" id="location" name="location" style="background-color: #43596c;color: white;">
                                <div class="valid-feedback">Looks good!</div>
                            </div>
                            <div class="col-md-4">
                                <label for="custPlaceOfSupply">Place of Supply*</label>
                                <select class="custom-select form-control" id="custPlaceOfSupply" name="place_of_supply" style="background-color: #43596c; color: white;" required>
                                    <option selected value="">Select Place of Supply</option>
                                    <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                    <option value="Andhra Predhesh">Andhra Predhesh</option>
                                    <option value="Arunachal Predesh">Arunachal Predesh</option>
                                    <option value="Assam">Assam</option>
                                    <option value="Bihar">Bihar</option>
                                    <option value="Chandigarh">Chandigarh</option>
                                    <option value="Chhattisgarh">Chhattisgarh</option>
                                    <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                    <option value="Damn anad Diu">Damn anad Diu</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Goa">Goa</option>
                                    <option value="Gujarat">Gujarat</option>
                                    <option value="Haryana">Haryana</option>
                                    <option value="Himachal Predesh">Himachal Predesh</option>
                                    <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                    <option value="Jharkhand">Jharkhand</option>
                                    <option value="Karnataka">Karnataka</option>
                                    <option value="Kerala">Kerala</option>
                                    <option value="Ladakh">Ladakh</option>
                                    <option value="Lakshadweep">Lakshadweep</option>
                                    <option value="Madhya Predesh">Madhya Predesh</option>
                                    <option value="Maharashtra">Maharashtra</option>
                                    <option value="Manipur">Manipur</option>
                                    <option value="Meghalaya">Meghalaya</option>
                                    <option value="Mizoram">Mizoram</option>
                                    <option value="Nagaland">Nagaland</option>
                                    <option value="Odisha">Odisha</option>
                                    <option value="Puducherry">Puducherry</option>
                                    <option value="Punjab">Punjab</option>
                                    <option value="Rajasthan">Rajasthan</option>
                                    <option value="Sikkim">Sikkim</option>
                                    <option value="Tamil Nadu">Tamil Nadu</option>
                                    <option value="Telangana">Telangana</option>
                                    <option value="Tripura">Tripura</option>
                                    <option value="Uttar Predesh">Uttar Predesh</option>
                                    <option value="Uttarakhand">Uttarakhand</option>
                                    <option value="West Bengal">West Bengal</option>
                                    <option value="Other Territory">Other Territory</option>
                                </select>
                                <div class="invalid-feedback">Please select a valid registration type.</div>
                            </div>
                        </div>
    
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="gstType">GST Type*</label>
                                <select class="form-control" id="custGstType" name="gst_type" style="background-color: #43596c; color: white;" required>
                                    <option selected value="">Select GST Type</option>
                                    <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                    <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                                    <option value="Unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                    <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                    <option value="Consumer">Consumer</option>
                                    <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                    <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                    <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                    <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% equality in creating business units in special economic zone)</option>
                                </select>
                                <div class="invalid-feedback">Please select a valid registration type.</div>
                            </div>
    
                            <div class="col-md-4 gstrow d-block" id="gstInValue">
                                <div>
                                    <label for="custGstIN">GSTIN*</label>
                                    <input type="text" class="form-control" onchange="checkgst(this)" id="custGstIN" name="gstin" style="background-color: #43596c;color: white;" placeholder="29APPCK7465F1Z1">
                                    <a data-toggle="modal" href="#exampleModal" style="color:#3dd5f3">Get Taxpayer Details</a>
                                    <div class="text-danger m-2" id="warngst"></div>
                                </div>
                            </div>
    
                            <div class="col-md-4">
                                <label for="panNo">PAN No.*</label>
                                <input type="text" class="form-control" id="panNo" name="pan_no" style="background-color: #43596c;color: white;" required onchange="checkpan(this)" placeholder="APPCK7465F">
                                <div class="text-danger m-2" id="warnpan"></div>
                            </div>
                        </div>
    
                        <div class="row">
                            <div class="col-md-4 mt-3">
                                <label for="validationCustom05">Opening Balance</label>
                                <div class="d-flex">
                                    <select name="balance_type" id="bal" class="form-select text-white mr-1" style="background-color: #243e54; width: 25%; border-radius: 5px;">
                                        <option value="debit">Debit</option>
                                        <option value="credit">Credit</option>
                                    </select>
                                    <input type="text" class="form-control" name="open_balance" id="openbalance" step="any" style="background-color: #43596c;color: white;">
                                    <div class="text-danger m-2" ></div>
                                </div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="creditLimit">Credit Limit</label>
                                <input type="text" class="form-control" name="credit_limit" style="background-color: #43596c;color: white;" step="any" id="creditLimit">
                                <div class="text-danger m-2" ></div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="custPaymentTerms">Payment Terms</label>
                                <div class="d-flex">
                                    <select name="payment_terms" id="custPaymentTerms" class="form-control">
                                        <option value="" selected>Choose</option>
                                        {% for p in pTerms %}
                                        <option value="{{p.id}}">{{p.term_name}}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="#newCustomerPaymentTerm" data-dismiss="modal" data-toggle="modal" class="btn btn-outline-secondary ml-1">+</a>
                                </div>
                            </div>
    
                            <div class="col-md-4 mt-3">
                                <label for="priceList">Price List</label>
                                <select name="price_list" id="priceList" class="form-control">
                                    <option value="" selected>Choose</option>
                                    {% for l in list %}
                                    <option value="{{l.id}}">{{l.name}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
    
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label for="custEmail">Email*</label>
                                <input type="email" class="form-control" required id="custEmail" name="email" onchange="checkemail(this)" style="background-color: #43596c;color: white;" placeholder="finsys@gmail.com">
                                <div id="warnemail" class="text-danger"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="custWebsite">Website</label>
                                <input type="text" class="form-control" id="custWebsite" required placeholder="www.finsys.com" onchange="checkweb(this)" name="website" style="background-color: #43596c;color: white;">
                                <div id="warnweb" class="text-danger"></div>
                            </div>
                            <div class="col-md-4">
                                <label for="custMobile">Mobile*</label>
                                <input type="text" class="form-control" id="custMobile" required onchange="checkphone(this)" name="mobile" style="background-color: #43596c;color: white;">
                                <div class="text-danger m-2" id="warnphone"></div>
                            </div>
                        </div>
                        <hr>
                        <div class="row mt-5">
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12 card-title">
                                        <h5 class="mb-0">Billing Address</h5>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mt-3">
                                        <div class="form-row">
                                            <label for="street">Street*</label>
                                            <textarea class="form-control street" required id="street" name="street" style="background-color: #43596c;color: white;"></textarea>
                                            <div class="invalid-feedback">Please provide a valid Street</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="city">City*</label>
                                            <input type="text" class="form-control" required id="city" name="city" style="background-color: #43596c;color: white;" placeholder="City">
                                            <div class="invalid-feedback">Please provide a valid City</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="state">State*</label>
                                            <select type="text" class="form-control" id="state" name="state" required style="background-color: #43596c; color: white;">
                                                <option value="" selected hidden>Choose</option>
                                                <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Predesh">Himachal Predesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Predesh">Madhya Predesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Predesh">Uttar Predesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                            <div class="invalid-feedback">Please provide a valid State</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="pinco">Pin Code*</label>
                                            <input type="text" class="form-control" required id="pinco" name="pincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                            <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="country">Country*</label>
                                            <input type="text" class="form-control" required id="country" name="country" style="background-color: #43596c;color: white;" placeholder="Country">
                                            <div class="invalid-feedback">Please provide a valid Country</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <h5>Shipping Address</h5>
                                        <input class="ml-4 ml-5" type="checkbox" onclick="placeShipAddress()" id="shipAddress" name="ship_address">
                                        <label class="ml-2 mt-1 ml-2" for="shipAddress">Same As Billing Address</label>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12 mt-3">
                                        <div class="form-row">
                                            <label for="shipstreet">Street</label>
                                            <textarea class="form-control" id="shipstreet" name="shipstreet" style="background-color: #43596c;color: white;"></textarea>
                                            <div class="invalid-feedback">Please provide a valid Street</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipcity">City</label>
                                            <input type="text" class="form-control" id="shipcity" name="shipcity" style="background-color: #43596c;color: white;" placeholder="City">
                                            <div class="invalid-feedback">Please provide a valid City</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipstate">State</label>
                                            <select type="text" class="form-control" id="shipState" name="shipstate" style="background-color: #43596c; color: white;">
                                                <option value="" selected>Choose</option>
                                                <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islands</option>
                                                <option value="Andhra Predhesh">Andhra Predhesh</option>
                                                <option value="Arunachal Predesh">Arunachal Predesh</option>
                                                <option value="Assam">Assam</option>
                                                <option value="Bihar">Bihar</option>
                                                <option value="Chandigarh">Chandigarh</option>
                                                <option value="Chhattisgarh">Chhattisgarh</option>
                                                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                                <option value="Damn anad Diu">Damn anad Diu</option>
                                                <option value="Delhi">Delhi</option>
                                                <option value="Goa">Goa</option>
                                                <option value="Gujarat">Gujarat</option>
                                                <option value="Haryana">Haryana</option>
                                                <option value="Himachal Predesh">Himachal Predesh</option>
                                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                <option value="Jharkhand">Jharkhand</option>
                                                <option value="Karnataka">Karnataka</option>
                                                <option value="Kerala">Kerala</option>
                                                <option value="Ladakh">Ladakh</option>
                                                <option value="Lakshadweep">Lakshadweep</option>
                                                <option value="Madhya Predesh">Madhya Predesh</option>
                                                <option value="Maharashtra">Maharashtra</option>
                                                <option value="Manipur">Manipur</option>
                                                <option value="Meghalaya">Meghalaya</option>
                                                <option value="Mizoram">Mizoram</option>
                                                <option value="Nagaland">Nagaland</option>
                                                <option value="Odisha">Odisha</option>
                                                <option value="Puducherry">Puducherry</option>
                                                <option value="Punjab">Punjab</option>
                                                <option value="Rajasthan">Rajasthan</option>
                                                <option value="Sikkim">Sikkim</option>
                                                <option value="Tamil Nadu">Tamil Nadu</option>
                                                <option value="Telangana">Telangana</option>
                                                <option value="Tripura">Tripura</option>
                                                <option value="Uttar Predesh">Uttar Predesh</option>
                                                <option value="Uttarakhand">Uttarakhand</option>
                                                <option value="West Bengal">West Bengal</option>
                                                <option value="Other Territory">Other Territory</option>
                                            </select>
                                            <div class="invalid-feedback">Please provide a valid State</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shippinco">Pin Code</label>
                                            <input type="text" class="form-control" id="shippinco" name="shippincode" style="background-color: #43596c;color: white;" placeholder="PIN code">
                                            <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mt-3">
                                        <div class="form-row">
                                            <label for="shipcountry">Country</label>
                                            <input type="text" class="form-control" id="shipcountry" name="shipcountry" style="background-color: #43596c;color: white;" placeholder="Country">
                                            <div class="invalid-feedback">Please provide a valid Country</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-4"></div>
                            <div class="col-4 d-flex justify-content-center">
                                <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="button" id="newCustomerSave">Save</button>
                            </div>
                            <div class="col-4"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>

<!-- Item Unit Create Modal -->

<div class="modal fade" id="createNewUnit">
    <div class="modal-dialog">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Item Unit</h5>
                <button type="button" class="close" data-toggle="modal" data-target="#newItem" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="newUnitForm">
                        {% csrf_token %}
                        <div class="row mt-2">
                            <div class="col-12">
                                <label for="name">Unit Name</label>
                                <input name="name" id="unit_name" class="form-control text-uppercase w-100">
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12 d-flex justify-content-center">
                                <button class="btn btn-outline-info text-grey" data-toggle="modal" data-target="#newItem" type="button" id="saveItemUnit">Save</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>
   
<!-- New Item Modal -->

<div class="modal fade" id="newItem">
    <div class="modal-dialog modal-xl">
        <div class="modal-content" style="background-color: #213b52;">
            <div class="modal-header">
                <h5 class="m-3">New Item</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card p-3">
                    <form method="post" id="newItemForm">
                        {% csrf_token %}

                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="itemName" style="color: white;">Name</label>
                                <input type="text" id="itemName" name="name" class="form-control" style="background-color: #2a4964; color: white;" autocomplete="off" required>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="itemType" style="color: white;">Type</label>
                                <select name="type" class="form-control" id="itemType" style="background-color: #2a4964; color: white;" required>
                                    <option selected disabled value="">Choose...</option>
                                    <option value="Goods">Goods</option>
                                    <option value="Services">Services</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="itemUnit" style="color: white;">Unit</label>
                                <div class="d-flex">
                                    <select class="custom-select" name="unit" id="itemUnit" required style="background-color: #2a4964; color: white;">
                                        <option selected disabled value="">Choose...</option>
                                        {% for a in units %}
                                        <option class="text-uppercase">{{ a.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <a href="#">
                                        <button type="button" class="btn btn-outline-secondary ml-1" data-dismiss="modal" data-toggle="modal" data-target="#createNewUnit">+</button>
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="hsnField" style="color: white;">HSN Code</label>
                                <input type="number" name="hsn" class="form-control" style="background-color: #2a4964; color: white;" placeholder="Enter a valid HSN code" required id="hsnField" oninput="validateHSN()">
                                <div id="hsnError" style="color: red;"></div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Tax Reference</label>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check mt-1">
                                    <input class="form-check-input" name="taxref" type="radio" id="inclusive" value="taxable" onclick="showdiv()" required>
                                    <label style="color: white;" for="inclusive">taxable</label>
                                </div>
                            </div>
                            <div class="form-check mt-1">
                                <input class="form-check-input" name="taxref" type="radio" value="non taxable" id="check" onclick="hidediv()">
                                <label style="color: white;" for="check">non taxable</label>
                            </div>
                        </div>
                        <div class="row"  id="taxableDiv" style="display: none;">
                            <div class="col-md-6 mt-3">
                                <label for="intraStateTax" style="color: white;">Intra State Tax Rate</label>
                                <select name="intra_st" class="form-control" style="background-color: #2a4964; color: white;" id="intraStateTax" >
                                    <option value=0>GST 0 (0%)</option>
                                    <option value=3>GST 3 (3%)</option>
                                    <option value=5>GST 5 (5%)</option>
                                    <option value=12>GST 12 (12%)</option>
                                    <option value=18>GST 18 (18%)</option>
                                    <option value=28>GST 28 (28%)</option>        
                                </select>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="interStateTax" style="color: white;">Inter State Tax Rate</label>
                                <select name="inter_st" class="form-control" style="background-color: #2a4964; color: white;" id="interStateTax" >
                                    <option value=0>IGST 0 (0%)</option>
                                    <option value=3>IGST 3 (3%)</option>
                                    <option value=5>IGST 5 (5%)</option>
                                    <option value=12>IGST 12 (12%)</option>
                                    <option value=18>IGST 18 (18%)</option>
                                    <option value=28>IGST 28 (28%)</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Purchase Price</label>
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <input type="text" class="form-control mr-1" value="INR" style="width:60px;background-color: #2a4960; color: white;">
                                        <input type="number" name="pcost" class="form-control" id="purprice" style="background-color: #2a4964; color: white;" value="0">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Sales Price</label>
                                <div class="row">
                                    <div class="col-md-12 d-flex">
                                        <input type="text" class="form-control mr-1" value="INR" style="width:60px;background-color: #2a4960; color: white;">
                                        <input type="text" name="salesprice" class="form-control" id="saleprice" style="background-color: #2a4964; color: white;" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="purchaseAccount" style="color: white;">Account</label>
                                <div class="d-flex">
                                    <select name="pur_account" class="form-control" style="background-color: #2a4964; color: white;" id="purchaseAccount">
                                        <option value="" selected disabled>--Choose--</option>
                                        {% for a in accounts %}
                                        <option value="{{ a.account_name }}">{{ a.account_name }}</option>
                                        {% endfor %}
                                    </select>
                                    <button type="button" data-dismiss="modal" data-toggle="modal" data-target="#createNewAccount" class="btn btn-outline-secondary ml-1" id="openAccountModal">+</button>
                                </div>
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="salesAccount" style="color: white;">Account</label>
                                <select name="sale_account" class="form-control" style="background-color: #2a4964; color: white;" id="salesAccount">
                                    <option value="" selected disabled>--Choose--</option>
                                    <option value="General Income">General Income</option>
                                    <option value="Interest Income">Interest Income</option>
                                    <option value="Late Fee Income">Late Fee Income</option>
                                    <option value="Discount Income">Discount Income</option>
                                    <option value="Shipping Charges">Shipping Charges</option>
                                    <option value="Other Charges">Other Charges</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mt-3">
                                <label for="purchaseDescription" style="color: white;">Description</label>
                                <textarea class="form-control" name="pur_desc" id="purchaseDescription" style="background-color: #2a4964; color: white;"></textarea>  
                            </div>
                            <div class="col-md-6 mt-3">
                                <label for="salesDescription" style="color: white;">Description</label>
                                <textarea class="form-control" name="sale_desc" id="salesDescription" style="background-color: #2a4964; color: white;"></textarea>
                            </div>
                        </div>
                                    
                        <div class="row mt-3" >
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" onclick="ShowHideDiv(this)" type="checkbox"  id="track">
                                    <label class="form-check-label" for="track">Track Inventory</label>
                                </div>  
                            </div>
                        </div>
                        <div class="row" id="inventorytrack" style="display: none">
                            <div class="col-md-6 mt-3">
                                <label style="color: white;">Inventory Account</label>
                                <select name="invacc" id="invAcc" class="form-control" style="background-color: #2a4964; color: white;">
                                    <option selected disabled value="" >Choose...</option>
                                    <option value="Inventory Assets">Inventory Assets</option>    
                                </select>
                            </div>
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Stock on hand</label>
                                <input type="number" name="stock" id="stockOnHand" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Stock Rate per Unit</label>
                                <input type="number" id="stockRate" name="stock_rate" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                        </div>

                        <div class="row" >
                            <div class="col-md-3 mt-3">
                                <label style="color: white;">Minimum Stock to maintain</label>
                                <input type="number" id="minStock" name="min_stock" class="form-control" style="background-color: #2a4964; color: white;" value="0">
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-4"></div>
                            <div class="col-4 d-flex justify-content-center">
                                <button class="btn btn-outline-secondary text-grey w-75" data-dismiss="modal" type="submit" id="saveNewItem">Save</button>
                            </div>
                            <div class="col-4"></div>
                        </div>
                    </form>
                </div>
            </div>
        </div>   
    </div>
</div>

        
    
    <script src="{% static 'assets/plugins/select2/js/select2.min.js' %}"></script>    
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>


    <script>

        function reloadCustomer(title,fName,lName) {
            const fullName = title+' '+fName+' '+lName
            $.ajax({
                url: "{% url 'Fin_getCustomers' %}",
                type: "GET",
                dataType: "json",
                data: {},
    
                success: function(data) {
                    console.log('Ajax Response ->',data);
                    var custDrpDwn = $('#cust_drop');
                    custDrpDwn.empty();
                    custDrpDwn.append(`<li class="dropdown-item customers-options" onclick="getCustomerDetails('','')">Select Customer</li>`);
    
                    $.each(data, function (key, value) {
                        const customerDetails = `${value[1]} ${value[2]} ${value[3]}`;
                        const ID = `${value[0]}`
    
                        if(customerDetails == fullName){
                            getCustomerDetails(value[0], customerDetails)
                        }
                        const listItem = $(`
                            <li class="dropdown-item customers-options" onclick="getCustomerDetails('${ID}', '${customerDetails}')">${customerDetails}</li>`
                        );
                        custDrpDwn.append(listItem);
                    });
                    console.log('Customers RELOADED');
    
                },
                error: function(xhr, status, error) {
                    console.error(xhr.responseText);
                }
    
            });
            // refreshCustomerDetails();
    
            if ($('#newCustomerPaymentTerm').hasClass('show')){
                $('#newCustomerPaymentTerm').modal('toggle');
            }
        }


        $(document).ready(function() {
            $("#paymentMethod").change(function() {
                var x=$('#paymentMethod').val();
                if(x==='Cash'){
                    $('#chequediv').hide()
                    $('#bnkdiv').hide()
                    $('#upidiv').hide()
                    document.getElementById('cheque_id').value=""
                    document.getElementById('upi_id').value=""
                    document.getElementById('bnk_id').value=""
                }else if(x==='Cheque'){
                    $('#chequediv').show()
                    $('#bnkdiv').hide()
                    $('#upidiv').hide()
                    document.getElementById('upi_id').value=""
                    document.getElementById('bnk_id').value=""
                }else if(x==='UPI'){
                    $('#upidiv').show()
                    $('#bnkdiv').hide()
                    $('#chequediv').hide()
                    document.getElementById('cheque_id').value=""
                    document.getElementById('bnk_id').value=""
                }else{
                    $('#bnkdiv').show()
                    $('#chequediv').hide()
                    $('#upidiv').hide()
                    document.getElementById('cheque_id').value=""
                    document.getElementById('upi_id').value=""
    
                    $.ajax({
                        type: "GET",
                        url: "{% url 'Fin_getBankAccount' %}",
                        data: {
                            id: $('#paymentMethod').find(':selected').attr('text'),
                        },
                        success: function (response) {
                            if (response.status){
                                document.getElementById('cheque_id').value="";
                                document.getElementById('upi_id').value="";
                                document.getElementById("bnk_id").value = response.account;
                            }else{
                                alert(response.message);
                            }
                        }
                    });
                }
            });
        });

        
        $(document).on('change',function(){
            var paid_off=$('#paid').val();
           var total=$('#grandtotal').val();
           var bal=total-paid_off;
           $('#balance').val(bal);
            
        })
    </script>
    <script>
       function check_credit_note_number(){

            var str=document.getElementById('credit_no').value;

            var ref_no=document.getElementById('referenceNumber').value;
            var ref_len=ref_no.length;
            var x=ref_len
            var sliced_string=str.slice(-x,)

            if(parseInt(ref_no) == parseInt(sliced_string))
            {
                document.getElementById('credit_span').style.color="green";
                document.getElementById('credit_span').innerHTML="consicutive number";

            }
            else{
                document.getElementById('credit_span').style.color="red";
                document.getElementById('credit_span').innerHTML="not consicutive number";
            }
        }
    </script>

    <script>

        

    // <script>
        

    //         function saveAsDraftDialog() 
    //         {

    //         var frm = document.getElementById("forms");
    //         frm.action = ("")
    //         }
    //         function saveDialog() 
    //         {

    //         var frm = document.getElementById("forms");
    //         frm.action = ("")
    //         }
    // </script>
    <script>
        function show_fields()
        {
            var option=document.getElementById('select_payment').value;
            if(option == 'Cash'){
                document.getElementById('acc_no_label').style.display='none';
                document.getElementById('acc_no').style.display='none';
                document.getElementById('cheque_no_label').style.display='none';
                document.getElementById('cheque_no').style.display='none';
                document.getElementById('upi_id_label').style.display='none';
                document.getElementById('upi_id').style.display='none';
            }
            else if(option == 'Cheque'){
                document.getElementById('acc_no_label').style.display='none';
                document.getElementById('acc_no').style.display='none';
                document.getElementById('cheque_no_label').style.display='block';
                document.getElementById('cheque_no').style.display='block';
                document.getElementById('upi_id_label').style.display='none';
                document.getElementById('upi_id').style.display='none';

            }
            else if(option == 'UPI'){
                document.getElementById('acc_no_label').style.display='none';
                document.getElementById('acc_no').style.display='none';
                document.getElementById('cheque_no_label').style.display='none';
                document.getElementById('cheque_no').style.display='none';
                document.getElementById('upi_id_label').style.display='block';
                document.getElementById('upi_id').style.display='block';
            }
            else if(option == 'no_option'){
                document.getElementById('acc_no_label').style.display='none';
                document.getElementById('acc_no').style.display='none';
                document.getElementById('cheque_no_label').style.display='none';
                document.getElementById('cheque_no').style.display='none';
                document.getElementById('upi_id_label').style.display='none';
                document.getElementById('upi_id').style.display='none';
            }
            else
            {
                
                document.getElementById('acc_no_label').style.display='block';
                document.getElementById('acc_no').style.display='block';
                document.getElementById('cheque_no_label').style.display='none';
                document.getElementById('cheque_no').style.display='none';
                document.getElementById('upi_id_label').style.display='none';
                document.getElementById('upi_id').style.display='none';
            }
        }
    </script>

    <script>
        $(document).on('change', '#openbalance',function () {
            openbal = $("#openbalance").val()
            if($('#bal').val()=='credit'){
                if(openbal.slice(0,1) != '-'){
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                document.getElementById("openbalance").value = openbal
            }
        });
    
        $(document).on('change', '#bal',function () {
            openbal = $("#openbalance").val()
            if(openbal != ""){
                if($('#bal').val()=='credit'){
                    openbal = $("#openbalance").val()
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    openbal = $("#openbalance").val()
                    document.getElementById("openbalance").value = openbal.slice(1,)
                }
            }
        });
    </script>
{% endblock %}